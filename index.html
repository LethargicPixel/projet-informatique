<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="utf-8">
		<title>Nonogramm</title>
		<link rel="stylesheet" type="text/css" href="./style.css">
		<script src="https://brython.info/brython.js"></script>
		<script src="https://brython.info/brython_stdlib.js"></script>
	</head>
	<body onload="brython()">
		<h1>Nonogramm</h1>
		<div>
			<p>methode de creation de la grille</p>
			<input class="btn" type="button" value="aleatoire" id="btnAleatoire" onclick="montreZone()">
			<input class="btn" type="button" value="importer" id="btnImporter">
		</div>
		<div id="aleatoire" style="visibility: hidden;" >
			<p id="message">attention, toutes valeur depassant 100 peu faire ralentir le proggramme</p>
			<input type="number" name="rentrez la taille de la grille" id="entreeTaille" onkeydown="construitGrille(event)">
			<input class="btn" type="button" id="btnValider" value="Validez" onclick="construitGrille()">
		</div>
		<table id="grille" cellspacing="0px" >

		</table>
		<div>
			<input type="button" id="montreIndex" class="btn" value="creer les indices" style="visibility: hidden;" >
		</div>

		<script>

			let btnAleatoire=document.getElementById("btnAleatoire")
			let btnImport=document.getElementById("btnImporter")
			let entreeTaille=document.getElementById("entreeTaille")

			let grille=document.getElementById("grille")
			grille.border=1

			function montreZone(){

				document.getElementById("aleatoire").style.visibility="visible"
			}



			function construitGrille(event){
				if (!event || event.key==="Enter"){
					while (grille.rows.length > 0) {
						grille.deleteRow(0)
					}
					if (entreeTaille.value>0){
						document.getElementById("montreIndex").style="visible"
						for (i=0;i<=entreeTaille.value;i++){
							var ligne=grille.insertRow()

							for (j=0;j<=entreeTaille.value;j++){
								var cellule=ligne.insertCell()
								cellule.style.padding=Math.floor(Math.floor(window.innerHeight/5)/entreeTaille.value)+"px"
								cellule.id=i+','+j
							}
						}
					}
				}
			}
		</script>


		<script type="text/python">
			from browser import document
			from browser import html
			from nonogramm import Grille, Type

			btnValider=document["btnValider"]
			entreeTaille=document["entreeTaille"]
			tableau=document["grille"]
			aResoudre=Grille()
			resolu=Grille()
			idPremiereLigne=[]
			idPremiereColonne=[]
			montreIndex=document["montreIndex"]

			def aleatoire(ev):
				if ev.type=="click":
					ev.key="Enter"
				if ev.key=="Enter" or ev.type=="click":
					taille=document["entreeTaille"].value
					if taille=='':taille=0
					taille=int(taille)

					if taille>0:

						for i in range(taille+1):
							idPremiereLigne.append(f"0,{i}")
							idPremiereColonne.append(f"{i},0")

						aResoudre.creerGrilleHasard(taille,taille)
						resolu.lignes=aResoudre.copie()
						indexs=aResoudre.positionsFinal()
			
			def afficheIndexLigne(ev):
				index=aResoudre.getPosition()[Type.ligne]
				
				for i in idPremiereLigne[1:]:
					celluleARemplir=document[i]
					valeur=i.split(",")
					chaine=index[int(valeur[1])-1]
					chaine=html.P("<br>".join(map(str,chaine)))
					document[i] <= chaine

			def afficheIndexColonne(ev):
				index=aResoudre.getPosition()[Type.colonne]
				
				for i in idPremiereColonne[1:]:
					celluleARemplir=document[i]
					valeur=i.split(",")
					chaine=index[int(valeur[0])-1]
					chaine=html.P(" ".join(map(str,chaine)))
					document[i] <= chaine			
				montreIndex.style.visibility="hidden"
					


			btnValider.bind("click",aleatoire)
			entreeTaille.bind("keypress",aleatoire)

			montreIndex.bind("click",afficheIndexLigne)
			montreIndex.bind("click",afficheIndexColonne)
			

		</script>

	</body>
</html>

