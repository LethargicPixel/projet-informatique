<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <title>Nonogramm</title>
    <link rel="stylesheet" type="text/css" href="./style.css" />
    <script src="https://cdn.jsdelivr.net/npm/brython@3/brython.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/brython@3/brython_stdlib.js"></script>
  </head>

  <body onload="brython()">
    <h1>Nonogramm</h1>
    <div>
      <p>methode de creation de la grille</p>
      <input
        class="btn"
        type="button"
        value="aleatoire"
        id="btnAleatoire"
        onclick="montreZone()"
      />
      <input
        class="btn"
        type="button"
        value="index"
        id="btnindex"
        onclick="montreZone2()"
      />
    </div>

    <div id="aleatoire" style="visibility: hidden">
      <p id="message">
        attention, toutes valeures depassant 10 peu faire ralentir le proggramme
      </p>
      <label for="entreeTaille">rentrez la taille de la grille :</label>
      <input type="number" id="entreeTaille" />
      <input class="btn" type="button" id="btnValider" value="Validez" />
    </div>

    <div id="divTable">
      <table id="grille"></table>
    </div>
    <div>
      <input
        type="button"
        id="montreIndex"
        class="btn"
        value="creer les indices"
        style="display: none"
      />
    </div>
    <div style="flex-direction: column">
      <p id="msgApresIndice" style="visibility: hidden">
        par qui voulez vous que le nonogramm soit remplis ?
      </p>

      <div>
        <input
          type="button"
          value="ordinateur"
          class="btn"
          id="ordi"
          style="visibility: hidden"
        />
        <input
          type="button"
          value="joueur"
          class="btn"
          id="joueur"
          style="visibility: hidden"
        />
      </div>
    </div>

    <script>
      let btnAleatoire = document.getElementById("btnAleatoire");
      let btnImport = document.getElementById("btnindex");
      let btnValider = document.getElementById("btnValider");
      let entreeTaille = document.getElementById("entreeTaille");
      let btnIndice = document.getElementById("montreIndex");
      let grille = document.getElementById("grille");
      let btnOrdi = document.getElementById("ordi");
      let btnJoueur = document.getElementById("joueur");

      let taille = 0;
      let idPremiereColonne = [];
      let idPremiereLigne = [];
      grille.border = 1;

      function montreZone() {
        document.getElementById("aleatoire").style.visibility = "visible";
      }

      function construitGrille(event) {
        if (event.type == "click" || event.key === "Enter") {
          while (grille.rows.length > 0) {
            grille.deleteRow(0);
          }

          const taille_image = screen.width / entreeTaille.value / 5;
          btnIndice.style.visibility = "hidden";

          if (entreeTaille.value > 0) {
            btnOrdi.style.visibility = "hidden";
            btnJoueur.style.visibility = "hidden";
            btnIndice.style = "visibility:visible";
            document.getElementById("msgApresIndice").style.visibility =
              "hidden";

            taille = entreeTaille.value;

            for (i = 0; i <= taille; i++) {
              var ligne = grille.insertRow();

              for (j = 0; j <= taille; j++) {
                var image_blanche = document.createElement("img");
                image_blanche.setAttribute("src", "images/blanc.png");
                image_blanche.setAttribute("width", taille_image);
                image_blanche.setAttribute("length", taille_image);
                var cellule = ligne.insertCell();
                var paragraphe = document.createElement("p");

                if ((i != 0 && j != 0) || (i == j && i == 0)) {
                  cellule.appendChild(image_blanche);
                } else {
                  cellule.appendChild(paragraphe);
                }
                cellule.id = i + "," + j;
              }
            }
            creerlisteId();
          }
        }
      }

      function creerlisteId() {
        idPremiereColonne = [];
        idPremiereLigne = [];
        for (i = 1; i <= taille; i++) {
          idPremiereColonne.push(`${i},0`);
          idPremiereLigne.push(`0,${i}`);
        }
      }
      function listeId() {
        return [idPremiereColonne, idPremiereLigne, taille];
      }

      entreeTaille.addEventListener("keydown", construitGrille);
      btnValider.addEventListener("click", construitGrille);
    </script>

    <script type="text/python">
      from browser import document
      from browser import html
      from browser import window
      from nonogramm import Grille, Type

      btnValider=document["btnValider"]
      entreeTaille=document["entreeTaille"]

      tableau=document["grille"]

      aResoudre=Grille()
      resolu=Grille()

      montreIndex=document["montreIndex"]
      btnOrdi=document["ordi"]
      btnJoueur=document["joueur"]

      idPremiereLigne=[]
      idPremiereColonne=[]

      def aleatoire(ev):
      	if ev.type=="click":
      		ev.key="Enter"
      	if ev.key=="Enter" or ev.type=="click":

      		taille=window.listeId()[2]

      		if taille=='':
      			taille=0
      		taille=int(taille)


      		if taille>0:

      			aResoudre.creerGrilleHasard(taille,taille)
      			resolu.lignes=aResoudre.copie()
      			aResoudre.resoud()



      def afficheIndexLigne(ev):

      	index=aResoudre.getPosition()[Type.ligne]
      	idPremiereLigne=list(window.listeId()[1])


      	for i in idPremiereLigne:
      		print

      		celluleARemplir=document[i]
      		identifiant=i.split(",")[1]


      		chaine=index[int(identifiant)-1]

      		chaine="<br>".join(map(str,chaine))


      		document[i].removeChild(document[i].firstChild)
      		document[i] <= html.P(chaine)




      def afficheIndexColonne(ev):

      	index=aResoudre.getPosition()[Type.colonne]
      	idPremiereColonne=list(window.listeId()[0])

      	for i in idPremiereColonne:
      		celluleARemplir=document[i]
      		identifiant=i.split(",")[0]


      		chaine=index[int(identifiant)-1]

      		chaine=" ".join(map(str,chaine))
      		document[i].firstChild.textContent=chaine

      def afficheBoutons(ev):
      	montreIndex.style.visibility="hidden"
      	document["msgApresIndice"].style.visibility="visible"
      	btnOrdi.style.visibility="visible"
      	btnJoueur.style.visibility="visible"




      def afficher(ev):
      	taille=int(window.listeId()[2])

      	for j in range(1,taille+1):
      		for i in range(1,taille+1):

      			caseARemplir=document[f"{j},{i}"]

      			if aResoudre.lignes[i-1][j-1].getValeur()==True:
      				aAfficher="images/noir.jpg"
      			elif aResoudre.lignes[i-1][j-1].getValeur()==False:
      				aAfficher="images/croix.png"
      			else:
      				aAfficher="images/interrogation.jpg"


      			caseARemplir.firstChild.src=aAfficher





      montreIndex.bind("click",aleatoire)
      montreIndex.bind("click",afficheIndexLigne)
      montreIndex.bind("click",afficheIndexColonne)
      montreIndex.bind("click",afficheBoutons)

      btnOrdi.bind("click",afficher)
    </script>
  </body>
</html>
